name: Publish (FolderProfile only)

on:
  workflow_dispatch: {}   # ручной запуск из Actions

jobs:
  build:
    runs-on: windows-latest
    defaults:
      run:
        working-directory: SteadyState.MainProject.WPF   # корень проекта

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '6.0.x'   # под net6.0-windows

      - name: Publish via FolderProfile
        run: >
          dotnet publish SteadyState.MainProject.WPF.csproj
          -c Release
          /p:PublishProfile=FolderProfile

      # просто показать, что собралось и куда
      - name: Show publish output
        shell: pwsh
        run: |
          $outDir = "bin/Release/net6.0-windows/publish/win-x64"
          if (-not (Test-Path $outDir)) {
            Write-Host "Publish directory not found at expected path: $outDir"
            Write-Host "Listing Release tree to help debug:"
            Get-ChildItem -Recurse -Force "bin/Release" | Select-Object FullName, Length, LastWriteTime
            throw "Expected publish directory missing"
          }
          Write-Host "Publish directory: $outDir"
          Get-ChildItem $outDir | Select-Object Name, Length, LastWriteTime
